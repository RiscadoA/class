type Id {
    recvty T; recv ~T; send T; close
};;

proc id(x: Id) {
    println("id recvty");
    recvty x(U);
    println("id recv");
    recv x(y);
    println("id send");
    send x(y);
    println("id close");
    close x
};;

proc main() {
    cut {
        id(id)
        |id: ~Id|
        println("sendty");
        sendty id(close);
        println("send");
        send id(x. println("close x"); close x);
        println("recv");
        recv id(x);
        println("wait id");
        wait id;
        println("wait x");
        wait x;
        ()
    }
};;
