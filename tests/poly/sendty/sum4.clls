proc foo<C>(x: choice of {|#a: recv ~C; C |#b: close}) {
  #a x;
  recv x(y);
  fwd x y
};;

proc main() {
  cut {
    sendty x(lint);
    case x of {
      |#a:
        send x(4);
        println(x); ()
      |#b:
        wait x; ()
    }
    |x: recvty A; choice of {|#a: recv ~A; A |#b: close}|
    recvty x(B);
    foo<B>(x)
  }  
};;
