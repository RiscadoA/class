proc main() {
  cut {
    sendty x(wait);
    send x(y. println("wait 1"); wait y; ());
    sendty x(close);
    recv x(y);
    par {
      println("close 1"); close y
      ||
      send x(y. println("close 2"); close y);
      recv x(y); println("wait 2"); wait y;
      wait x;
      ()
    }
    |x: recvty A; recv ~A; recvty B; send A; recv ~B; send B; close|
    recvty x(A);
    recv x(a);
    recvty x(B);
    send x(a);
    recv x(b);
    send x(b);
    close x
  }
};;
