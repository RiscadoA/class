type Id(T) {
    recv ~T; send T; close
};;

proc id<T>(x: Id(T)) {
    println("id recv");
    recv x(y);
    println("id send");
    send x(y);
    println("id close");
    close x
};;

proc main() {
    cut {
        id<wait>(id)
        |id: ~Id(wait)|
        println("send");
        send id(x. println("wait x"); wait x; ());
        println("recv");
        recv id(x);
        println("wait id");
        wait id;
        println("close x");
        close x
    }
};;
