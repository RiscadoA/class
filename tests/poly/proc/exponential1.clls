proc foo<A>(x: recv ?~A; send A; A) {
  recv x(a);
  call a(a1);
  call a(a2);
  send x(a1);
  fwd x a2
};;

proc main() {
  cut {
    send x(a. !a(b); println(b); ());
    recv x(a);
    par {
      let a 1
      ||
      let x 2
    }
    |x: recv ?lint; send ~lint; ~lint|
    foo<~lint>(x)
  }
};;
