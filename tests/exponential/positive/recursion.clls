type rec Nat {
    choice of {
        |#Z: close
        |#S: Nat
    }
};;

proc rec printNat(n: ~Nat) {
    unfold n;
    case n of {
        |#Z: println("Z"); wait n; ()
        |#S: print("S "); printNat(n)
    }
};;

proc main() {
    cut {
        !n(n: Nat);
        unfold n; #S n;
        unfold n; #Z n; close n
        |n: ?~Nat|
        ?n;
        par {
            call n(x);
            printNat(x)
            ||
            call n(y);
            printNat(y)
        }
    }
};;
