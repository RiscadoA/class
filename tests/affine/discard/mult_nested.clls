proc main() {
    cut {
        println("affine 1"); affine x;
        println("send 1"); send x(a. println("close 1"); close a);
        println("affine 2"); affine x;
        println("send 2"); send x(b. println("close 2"); close b);
        println("affine 3"); affine x;
        println("send 3"); send x(c. println("wait 3"); wait c; ());
        println("close 3"); close x
        |x: ~affine send close; affine send close; affine send wait; close|
        println("use 1"); use x;
        println("recv 1"); recv x(a);
        println("wait 1"); wait a;
        println("discard 2"); discard x
    }
};;
