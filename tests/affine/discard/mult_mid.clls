proc main() {
    par {
        cut {
            println("send 1"); send x(a.
                println("close 1"); close a
            );
            println("affine"); affine x;
            println("send 2"); send x(b.
                println("wait 3"); wait b; ()
            );
            println("close 2"); close x
            |x: recv wait; coaffine recv close; wait|
            println("recv 1"); recv x(a);
            println("wait 1"); wait a;
            println("discard"); discard x
        }
        ||
        cut {
            println("close 4"); close x
            |x: wait|
            println("wait 4"); wait x; ()
        }
    }
    
};;
