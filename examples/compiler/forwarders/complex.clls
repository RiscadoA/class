proc main() {
    cut {
        #A a;
        wait a;
        ()
        |a: offer of { |#A: close }|
        case a of {
            |#A: #A b; fwd a b
        }
        |b: offer of { |#A: close }|
        case b of {
            |#A: close b
        }
    }
};;
